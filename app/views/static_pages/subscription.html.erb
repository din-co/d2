<div class="bg-tan">
  <div class="container">
    <h1 class="hr-header">Become a Regular</h1>
  </div>
</div>

<div class="container container--main">

  <form>
    <div class="container">

      <!--
      <p class="form-inline">
        I need to serve
        <select class="form-control">
          <% (1..12).each do |n| %>
            <option<%= ' selected="selected"' if n == 2 %>><%= n %></option>
          <% end -%>
        </select>
        people
        <select class="form-control">
          <% (1..12).each do |n| %>
            <option<%= ' selected="selected"' if n == 2 %>><%= n %></option>
          <% end -%>
        </select>
        meals per week.
      </p>
      -->

      <div>
        <p><strong>By popular demand, Subscription is back</strong> for Din regulars who want tasty meals delivered on their schedule. Learn about <a href="#benefits" class="text-nowrap">subscription benefits</a> and <a href="#how-it-works">how subscription works</a>.</p>
      </div>

      <h3>Become a Din Regular</h3>

      <div class="row">
        <div class="col-sm-4">
          <div class="form-group">
            <h4>Menus</h4>
            <div class="radio-list">
              <% [["Tasting Menu", "Chef’s choice!"], ["Vegetarian Menu", "Keepin’ it green."], ["Protein Menu", "Mmmmm…meat."], ["50/50 Menu", "Half veg, half meat."],
                ].each_with_index do |menu, i| %>
                <div class="radio">
                  <label><input type="radio" name="menu" value="<%= menu[0].parameterize %>" data-value="<%= menu[0] %>" <%= ' checked="checked"' if i == 0 %>> <strong><%= menu[0] %></strong> <small class="text-nowrap"><%= menu[1] %></small></label>
                </div>
              <% end -%>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <h4>Meals</h4>
            <p class="form-inline">
              Deliver
              <select name="meals" class="form-control form-control--inline input-sm">
                <% (1..12).each do |n| %>
                  <option <%= 'selected="selected"' if n == 2 %>><%= n %></option>
                <% end -%>
              </select>
              meals. <em class="text-nowrap">Each meal is 2 servings.</em>
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <h4>Delivery Day and Time</h4>
            <div class="delivery-settings">
              <div class="delivery-settings__day radio-list">
                <% ["Monday", "Tuesday", "Wednesday"].each_with_index do |day, i| %>
                  <div class="radio">
                    <label><input type="radio" name="delivery_day" value="<%= day %>" <%= ' checked="checked"' if i == 0 %>> <%= day %></label>
                  </div>
                <% end -%>
              </div>
              <div class="radio-list">
                <% ["1–5pm", "6–8pm", "6–7pm", "7–8pm"].each_with_index do |window, i| %>
                  <div class="radio">
                    <label><input type="radio" name="delivery_window" value="<%= window %>" <%= ' checked="checked"' if i == 0 %>> <%= window %></label>
                  </div>
                <% end -%>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="optional-settings-link">
        <p>
          <a href="#show-optional-settings">Add allergen and diet preferences.</a> (optional)
        </p>
      </div>

      <div id="optional-settings" class="row" style="display: none">
        <div class="col-sm-4">
          <div class="form-group">
            <h4>Diets <small>(optional)</small></h4>
            <div class="checkbox-list">
              <% [["No specific diets", "no-diets"], "dairy-free", "gluten-free", "nut-free", "soy-free", "pork-free", ["vegetarian (lacto-ovo)", "vegetarian"], "vegan"].each_with_index do |diet, i| %>
                <% label = diet.is_a?(Array) ? diet[0] : diet %>
                <% value = diet.is_a?(Array) ? diet[1] : diet.parameterize %>
                <div class="radio">
                  <div class="checkbox"><label><input type="checkbox" name="diets" class="js_checkbox-set diets-checkbox" data-set="diets" value="<%= value %>" <%= ' checked="checked"' if i == 0 %>> <%= label %></label></div>
                </div>
              <% end -%>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <h4>Allergens <small>(optional)</small></h4>
            <div class="checkbox-list">
              <% [["No allergens", "no-allergens"], "eggs", "fish", "milk", "peanuts", "shellfish", "soybeans", ["tree nuts", "tree-nuts"], "wheat"].each_with_index do |allergen, i| %>
                <% label = allergen.is_a?(Array) ? allergen[0] : allergen %>
                <% value = allergen.is_a?(Array) ? allergen[1] : allergen.parameterize %>
                <div class="radio">
                  <div class="checkbox"><label><input type="checkbox" name="allergens" class="js_checkbox-set allergens-checkbox" data-set="allergens" value="<%= value %>" <%= ' checked="checked"' if i == 0 %>> <%= label %></label></div>
                </div>
              <% end -%>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="container">

      <div class="form-group">
        <h4>Order Summary</h4>
        <ul>
          <li><span id="summary-delivery-day">Monday</span>, <span id="summary-delivery-window" class="text-nowrap">1–5pm</span> delivery</li>
          <li><span id="summary-delivery-menu">Tasting Menu</span></li>
          <li><span id="summary-meals">2 meals</span> (each meal is 2 servings)</li>
          <li>
            Only meals which
            are
            <span id="summary-diets">vegetarian and gluten-free</span>
            and
            do not contain:
            <span id="summary-allergens">nuts or eggs</span>.
          </li>
        </ul>
      </div>

      <div class="form-group">
        <button type="submit" class="btn btn-primary">Create Subscription</button>
      </div>

    </div>
  </form>
</div>

<div class="bg-tan">
  <div class="container">
    <div class="row">
      <div class="col-sm-6" id="benefits">
        <h2>Subscription Benefits</h2>
        <ul>
          <li>Free delivery (for orders over $60)</li>
          <li>Early access to new restaurant dishes likely to sell out.</li>
          <li>Din arrives on your schedule.</li>
          <li>Receive text/email with suggested meals 3 days before delivery.</li>
          <li>You’ll have 48 hours to change meals, or cancel your order each week.</li>
          <li>Pause your subscription when on vacation.</li>
          <li>You may cancel order before 5pm the day before delivery.</li>
          <!-- <li>Add multiple subscriptions to your account.</li> -->
        </ul>
      </div>
      <div class="col-sm-6" id="how-it-works">
        <h2>How Subscription Works</h2>
        <ol>
          <li>You choose your meal preferences and delivery settings.</li>
          <li>Din suggests meals 48 hours before delivery (via text/email). You have two options:
            <ul>
              <li>Suggested meals look exciting? Do nothing.</li>
              <li>Want to change meals, or cancel order? Click link to edit order.</li>
            </ul>
          </li>
          <li>Din delivers your order, chilled on dry ice. You place meals in the fridge, they’re good for a few days.</li>
          <li>When you’re hungry, cook up your tasty meals and enjoy with your loved ones!</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<script>
  $(function(){
    $(".optional-settings-link").click(function(){
      $(this).hide();
      $("#optional-settings").show();
    })
    $("input:checkbox, input:radio, select").change(function() {
      var name = $(this).attr('name');
      var value = $(this).data('value') || $(this).attr('value') || $(this).val();
      console.log(name, value);

      if (name == "delivery_day") {
        $("#summary-delivery-day").text(value);
      }
      if (name == "delivery_window") {
        $("#summary-delivery-window").text(value);
      }
      if (name == "meals") {
        $("#summary-meals").text(value + " " + (value == 1 ? "meal" : "meals"));
      }
      if (name == "menu") {
        $("#summary-delivery-menu").text(value);

        if (value == "vegetarian-menu") {
          $(".diets-checkbox").first().prop({checked: false})
          $(".diets-checkbox[value='vegetarian']").prop({checked: true})
        } else {
          var dietsChecked = $(".diets-checkbox:checked");
          if ((dietsChecked.length == 1) && (dietsChecked.attr('value') == "vegetarian")) {
            $(".diets-checkbox").prop({checked: false}).first().prop({checked: true});
          }
        }
      }

      if ($(this).hasClass("js_checkbox-set")) {
        var set = $("." + $(this).data("set") + "-checkbox");
        var setChecked = $("." + $(this).data("set") + "-checkbox:checked");
        var setDefault = set.first();
        if (setChecked.length == 0) {
          setDefault.prop({checked: true});
        } else if (setDefault.is($(this))) {
          set.prop({checked: false});
          setDefault.prop({checked: true});
        } else {
          setDefault.prop({checked: false});
        }
      }
      if (name == "allergens" || name == "diets") {
        var selectedItems = [];
        $("." + name + "-checkbox:checked").each(function(){
          selectedItems.push($(this).attr("value"));
        })
        var itemsJoined;
        if (selectedItems.length == 1) {
          itemsJoined = selectedItems.join(", ")
        } else {
          var lastItem = selectedItems.pop();
          itemsJoined = selectedItems.join(", ") + " and " + lastItem;
        }
        $("#summary-" + name + "").text(itemsJoined);
      }
    })
  })
</script>
